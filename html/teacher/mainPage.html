<!DOCTYPE html>
<html lang="en">
<head id="head">
</head>
<body>
<div id="menu"></div>
  <div class="container-fluid">
                <div class="row">
                  <!-- Left Side: Title and Main Content Box -->
                                    <div class="col-md-6">
                    <h4>Opdateringer</h4>
                    <h6>Seneste opdateringer</h6>
                    <div class="p-4">
                      <p>Her skal der laves bokse osv..</p>
                    </div>
                  </div>
              
                  <!-- Right Side: Two Smaller Boxes (Stacked) -->
                  <div class="col-md-6">
                    <div class="row">
                      <div class="col-md-12 mb-3">
                        <h4>Opgaver</h4>
                        <div class="bg-success text-white p-3">
                          Box 1 Content
                        </div>
                      </div>
                      <div class="col-md-12">
                        <h4>Begivenheder</h4>
                        <div class="bg-warning text-dark p-3">
                          Box 2 Content
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>

<script>

  document.addEventListener("DOMContentLoaded", async function()  {
    $(function() {
          $("#menu").load("http://localhost:5500/html/includes/menu.html");
       });
       $(function() {
          $("#head").load("http://localhost:5500/html/includes/head.html");
       });
      });

// Check if the JWT cookie is present
var cookies = document.cookie.split('; ');
       var myVariable;

for (var i = 0; i < cookies.length; i++) {
    var cookie = cookies[i].split('=');
    if (cookie[0] === 'JWT') {
        myVariable = cookie[1];
        break;
    }
}

       if (myVariable !== undefined) {
   decode(myVariable);
} else {
  window.location.href = "http://localhost:5500/index.html";
}  

  async function decode(JWT) {
    try {
      const response = await fetch("http://49.13.148.231:3000/rpc/jwt_decoder?jwt_token=" + JWT, {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoicG9zdGdyZXMifQ.thixYwIHRZruXR7QWz6suUrzy81LsXdQsms3BU6cdFg'
          // Add any additional headers if needed
        },
        // Add any function parameters as needed
      });
  
      if (!response.ok) {
        throw new Error(`HTTP error! Status: ${response.status}`);
      }
  
      const result = await response.json();
      var jsonObject = JSON.parse(result.replace(/'/g, '"'));
      var logged_in_user = await find_user(jsonObject.email);
      localStorage.setItem("logged_in_user", JSON.stringify(logged_in_user));
      console.log(JSON.parse(localStorage.getItem("logged_in_user")));
    } catch (error) {
      console.error('Error calling PostgREST function:', error.message);
    }
}
async function find_user(user_email) {
    try {
      const response = await fetch("http://49.13.148.231:3000/rpc/get_user_by_user_email?user_email=" + user_email, {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoicG9zdGdyZXMifQ.thixYwIHRZruXR7QWz6suUrzy81LsXdQsms3BU6cdFg'
          // Add any additional headers if needed
        },
        // Add any function parameters as needed
      });
  
      if (!response.ok) {
        throw new Error(`HTTP error! Status: ${response.status}`);
      }
  
      const result = await response.json();
      return result[0];
    } catch (error) {
      console.error('Error calling PostgREST function:', error.message);
    }
}
</script>
</body>
</html>